sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/f/library","sap/ui/core/Core"],function(e,t,o,s,n){"use strict";return e.extend("accessmanager1.controller.Detail",{onInit:function(){var e=this.getOwnerComponent();this.oRouter=e.getRouter();this.oModel=e.getModel();const t=new sap.ui.model.json.JSONModel({isEdit:false,showFooter:false});this.getView().setModel(t,"viewState");const o=new sap.ui.model.json.JSONModel({groupList:[]});this.getView().setModel(o,"editGroups");this.oRouter.getRoute("master").attachPatternMatched(this._onProductMatched,this);this.oRouter.getRoute("detail").attachPatternMatched(this._onProductMatched,this)},_loadOktaGroups:function(){const e=this.getView();const t=e.getModel("editGroups");const s=this.getOwnerComponent().getModel("oktaService");if(!t||!s){o.error("Missing models to load Okta groups.");return}const n=s.bindContext("/getOktaGroups(...)");n.setParameter("query","MFG");n.execute().then(()=>{const o=n.getBoundContext().getObject();const s=o?.value||[];t.setProperty("/groupList",s);console.log("✅ Groups loaded:",s.length);const r=e.getBindingContext("edit");if(r&&!r.getProperty("groupIds")&&s.length>0){const e=s[0].id;const t=s[0].profile?.name||s[0].name;r.setProperty("groupIds",e);r.setProperty("groupNames",t)}}).catch(e=>{console.error("❌ Failed to load groups:",e);o.error("Could not load Okta groups.")})},onGroupChange:function(e){const t=e.getParameter("selectedItem").getKey();const o=e.getParameter("selectedItem").getText();const s=this.getView().getBindingContext("edit");if(s){s.setProperty("groupIds",t);s.setProperty("groupNames",o)}console.log("Updated user with new group:",t,o)},_onProductMatched:function(e){this._product=e.getParameter("arguments").product||this._product||"0";var t="/"+this._product;this.getView().bindElement({path:t,model:"edit"})},onEditToggleButtonPress:function(){var e=this.getView().byId("ObjectPageLayout"),t=e.getShowFooter();e.setShowFooter(!t);const o=this.getView().getModel("viewState");const s=!o.getProperty("/isEdit");o.setProperty("/isEdit",s);if(s){this._loadOktaGroups()}sap.m.MessageToast.show(s?"Edit mode enabled":"Edit mode disabled")},onCancel:function(){const e=this.getView();const t=e.byId("ObjectPageLayout");const o=e.getModel("viewState");o.setProperty("/isEdit",false);t.setShowFooter(false);sap.m.MessageToast.show("Edit cancelled");this.oRouter.navTo("master",{layout:s.LayoutType.OneColumn})},onSave:function(){const e=this.getView();const t=this.getOwnerComponent().getModel();const o=e.getBindingContext("edit");if(!o){return sap.m.MessageBox.error("Cannot save: No binding context.")}const n=o.getObject();const r="/OKTAUsers('"+n.id+"')";e.setBusy(true);t.update(r,n,{success:()=>{e.setBusy(false);sap.m.MessageToast.show("✅ User updated successfully");this._exitEditMode?.();const t=this._getMasterList?.();if(t){t.getBinding("items").refresh()}this.oRouter.navTo("master",{layout:s.LayoutType.OneColumn})},error:t=>{e.setBusy(false);console.error("❌ Save Error",t);sap.m.MessageBox.error("Update failed — check input or permissions.")},merge:true})},onActivateUser:async function(){const e=this.getView();const s=this.getView().getModel();const n=e.getBindingContext();if(!n){return o.warning("Please select a user first.")}const r=n.getProperty("id");try{await this._callOktaAction("activateUser",{userId:r});t.show(`✅ User ${r} activated`)}catch(e){console.error("Activation failed:",e);o.error(`❌ Failed to activate user ${r}`)}},onDeactivateUser:async function(){const e=this.getView();const s=this.getView().getModel();const n=e.getBindingContext();if(!n){return o.warning("Please select a user first.")}const r=n.getProperty("id");try{await this._callOktaAction("deactivateUser",{userId:r});t.show(`✅ User ${r} deactivated`)}catch(e){console.error("Deactivation failed:",e);o.error(`❌ Failed to deactivate user ${r}`)}},_callOktaAction:async function(e,t){const o=this.getView().getModel();return new Promise((s,n)=>{o.callFunction(`/${e}`,{method:"POST",urlParameters:t,success:s,error:n})})},onExit:function(){if(sap&&sap.navigation&&sap.navigation.toExternal){sap.navigation.toExternal({target:{shellHash:"#Shell-home"}})}else{window.top.location.href="https://discovery-sunrise.launchpad.cfapps.us20.hana.ondemand.com/site?siteId=0cf6c23e-def9-4ed5-a7fb-0b378ac9e3ed#Shell-home"}}})});
//# sourceMappingURL=Detail.controller.js.map