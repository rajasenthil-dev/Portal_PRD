sap.ui.define(["sap/ui/core/mvc/Controller","bckorders/model/formatter","sap/m/MessageBox"],(t,e,o)=>{"use strict";var s="sapUiResponsivePadding--header sapUiResponsivePadding--content sapUiResponsivePadding--footer";return t.extend("bckorders.controller.View1",{formatter:e,onInit:function(){var t=this.getOwnerComponent().getModel();const e=this.getView();const s=e.byId("smartFilterBar");e.setBusy(true);s.attachInitialized(function(){e.setBusy(false)});const i=this.getView().byId("table0");const r=i.getTable();this.bAuthorizationErrorShown=false;t.attachRequestFailed(function(t){var e=t.getParameters();if(e.response.statusCode==="403"){r.setNoData("No data available due to authorization restrictions");r.setBusy(false);if(!this.bAuthorizationErrorShown){this.bAuthorizationErrorShown=true;o.error("You do not have the required permissions to access this report.",{title:"Unauthorized Access",id:"messageBoxId1",details:"Permission is required to access this report. Please contact your administrator if you believe this is an error or require access.",contentWidth:"100px"})}}});r.attachEvent("rowsUpdated",this._calculateTotals.bind(this));var a=this.getOwnerComponent().getModel("logo");var n=a.bindList("/MediaFile");n.requestContexts().then(function(t){if(t.length>0){var e=t[0].getObject();console.log("Manufacturer:",e.MFGName);console.log("File URL:",e.url);var o=sap.ui.require.toUrl("bckorders").split("/resources")[0];if(o==="."){o=""}console.log("âœ… Dynamic Base Path:",o);var s=o+e.url;this.getView().byId("logoImage").setSrc(s)}else{console.log("No media found for this manufacturer.")}}.bind(this))},_calculateTotals:function(){const t=this.getView().byId("table0");const e=t.getTable();const o=e.getBinding("rows");if(!o){console.warn("Table binding is missing.");return}const s=o.getContexts(0,o.getLength());if(!s){console.warn("Data is not available for calculation.");return}const i=s.reduce((t,e)=>{const o=e.getObject();if(!o)return t;t.totalBackOrders++;t.impactedCustomers.add(o.KUNRE_ANA);t.totalItemsOnBackOrder.add(o.MATNR);t.totalUnitsBackOrdered+=parseFloat(o.BACK_ORD_QTY||0);t.totalExtension+=parseFloat(o.EXTENSION||0);if(o.DATE_DIFF>0&&!o.UDATE){t.totalUnitsToBeReceived+=parseFloat(o.BACK_ORD_QTY||0)}return t},{totalBackOrders:0,impactedCustomers:new Set,totalItemsOnBackOrder:new Set,totalUnitsBackOrdered:0,totalUnitsToBeReceived:0,totalExtension:0});const r=i.impactedCustomers.size;const a=i.totalItemsOnBackOrder.size;const n=this.formatter.formatCurrency(i.totalExtension,"USD");const l=this.formatter.formatNumber(i.totalUnitsBackOrdered);this._updateTile("TileContent1",this.formatNumberWithCommas(i.totalBackOrders));this._updateTile("TileContent2",this.formatNumberWithCommas(r));this._updateTile("TileContent3",this.formatNumberWithCommas(a));this._updateTile("TileContent4",this.formatNumberWithCommas(i.totalUnitsBackOrdered));this._updateTile("TileContent5",this.formatNumberWithCommas(i.totalUnitsToBeReceived));this._updateFooter("footerText1",l);this._updateFooter("footerText2",n)},formatNumberWithCommas:function(t){if(!t||isNaN(t))return"0";return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},_updateTile:function(t,e){const o=this.byId(t);if(o){o.setText(e)}else{console.warn(`Tile with ID ${t} not found.`)}},_updateFooter:function(t,e){const o=this.byId(t);if(o){o.setText(e)}else{console.warn(`Footer with ID ${t} not found.`)}}})});
//# sourceMappingURL=View1.controller.js.map