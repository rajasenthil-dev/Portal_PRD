sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/format/NumberFormat","sap/m/Dialog","sap/m/Button","sap/m/Image","sap/m/MessageBox"],(e,t,o,n,s,a,i)=>{"use strict";return e.extend("invoicehis.controller.View1",{onInit:function(){var e=this.getOwnerComponent().getModel();e.attachRequestFailed(function(e){var t=e.getParameters();if(t.response.statusCode==="403"){i.error("You currently do not have authorization to view this resource. If you feel this in incorrect please reach out to the administrator.")}else{i.error("An error occurred: "+t.response.message)}});var o=new t({counts:{UniqueInvoices:0,TotalSales:0,TotalSalesFormatted:0}});var n=new t({counts:{TSL_AMOUNT:0,CAL_PST:0,CAL_GST:0}});this.getView().setModel(o,"summaryCounts");this.getView().setModel(n,"footerCounts");this.getView().byId("table").attachEvent("rowsUpdated",this.onTableScroll.bind(this))},onTableScroll:function(){const e=this.getView().byId("table");const t=e.getBinding("rows").getContexts().map(e=>e.getObject());this.updateCalculations(t)},updateCalculations:function(e){const t=["TSL_AMOUNT","CAL_PST","CAL_GST"];const o="TSL_AMOUNT";const n="BELNR";const s=this.getView().getModel("footerCounts");const a=this.getView().getModel("summaryCounts");const i=s.getData();const r=a.getData();const c=r._uniqueInvoices||new Set;e.forEach(e=>{t.forEach(t=>{const o=typeof e[t]==="number"?e[t]:parseFloat(e[t])||0;const n=typeof i[t]==="number"?i[t]:parseFloat(i[t])||0;i[t]=parseFloat((n+o).toFixed(2))});if(e[n]){c.add(e[n])}const s=typeof e[o]==="number"?e[o]:parseFloat(e[o])||0;const a=typeof r["TotalSales"]==="number"?r["TotalSales"]:parseFloat(r["TotalSales"])||0;r["TotalSales"]=parseFloat((a+s).toFixed(2))});r["UniqueInvoices"]=c.size;r._uniqueInvoices=c;r["TotalSalesFormatted"]=this.formatLargeNumber(r["TotalSales"]);this.getView().getModel("footerCounts").setData(i);this.getView().getModel("summaryCounts").setData(r);console.log("Final footerCounts:",i);console.log("Final summaryCounts:",r)},formatLargeNumber:function(e){if(e>=1e6){return`$${(e/1e6).toFixed(2)}M`}else if(e>=1e3){return`$${(e/1e3).toFixed(2)}K`}return`$${e.toFixed(2)}`},onFilterChange:function(){const e=this.getView().byId("table");const t=e.getBinding("rows").getContexts().map(e=>e.getObject());const o=this.getView().getModel("footerCounts");const n=this.getView().getModel("summaryCounts");const s={UniqueInvoices:0,TotalSales:0,TotalSalesFormatted:0};const a={TSL_AMOUNT:0,CAL_PST:0,CAL_GST:0};o.setData(s);n.setData(a);this.updateCalculations(t)},formatLargeNumber:function(e){const t=o.getFloatInstance({style:"short",minFractionDigits:0,maxFractionDigits:1});return t.format(e)},_formatCurrency:function(e){if(e==null||e===undefined){return""}var t=sap.ui.getCore().getConfiguration().getLocale().getLanguage();var o;switch(t){case"en-US":o="USD";break;case"en-CA":o="CAD";break;case"fr-CA":o="CAD";break;default:o="USD";break}var n=sap.ui.core.format.NumberFormat.getCurrencyInstance({currencyCode:false,customCurrencies:{MyDollar:{isoCode:o,decimals:2}},groupingEnabled:true,showMeasure:true});return n.format(e,"MyDollar")},_formatDate:function(e){if(!e)return"";let t;if(typeof e==="string"){if(e.length===8){const o=e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6,8);t=new Date(o+"T00:00:00Z")}else{return""}}else if(e instanceof Date){t=new Date(e.getTime())}else{return""}if(isNaN(t.getTime())){return""}t.setMinutes(t.getMinutes()+t.getTimezoneOffset());const o=sap.ui.core.format.DateFormat.getDateInstance({style:"medium"});return o.format(t)},_removeLeadingZeros:function(e){return e?String(parseInt(e,10)):e},_formatNumberSuffix:function(e,t=true){if(typeof e!=="number"){return e}var o=Math.abs(e);let n;if(o>=1e6){if(t){n=(e/1e6).toFixed(2)+"M"}n=e/1e6+"M"}else if(o>=1e3){if(t){n=(e/1e3).toFixed(2)+"K"}n=e/1e3+"K"}else{if(t){n=n.toFixed(2)}n=e}return n},onInvoiceClick:function(e){const t=e.getSource().getText();const o=`/mock-api/invoices/${t}`;this._fetchInvoiceImage(o).then(e=>this._showInvoiceDialog(e)).catch(e=>sap.m.MessageToast.show("Failed to load invoice"))},_fetchInvoiceImage:function(e){return new Promise((e,t)=>{setTimeout(()=>{e("https://via.placeholder.com/600x800.png?text=Invoice")},1e3)})},_showInvoiceDialog:function(e){const t=new n({title:"Invoice",content:new a({src:e,width:"100%"}),buttons:[new s({text:"Download",press:()=>this._downloadImage(e)}),new s({text:"Print",press:()=>this._printImage(e)}),new s({text:"Close",press:function(){t.close()}})]});t.open()},_downloadImage:function(e){const t=document.createElement("a");t.href=e;t.download="invoice.png";t.click()},_printImage:function(e){const t=window.open("");t.document.write(`<img src='${e}' style='width:100%;'/>`);t.print();t.close()}})});
//# sourceMappingURL=View1.controller.js.map