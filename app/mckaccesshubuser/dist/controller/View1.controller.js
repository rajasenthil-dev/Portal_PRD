sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/m/WizardStep"],(e,t,r,s,o)=>{"use strict";var i={prevUserSelect:null};return e.extend("mckaccesshubuser.controller.View1",{onInit:function(){this._wizard=this.byId("wizard");this._oNavContainer=this.byId("wizardNavContainer");this._oWizardContentPage=this.byId("wizardContentPage");this._initModel();this.model=new t;const e=this.getView().getModel("userContext").getProperty("/selectedGroup");console.log("Selected Group:",e);this.model.setProperty("/selectedUser","InternalUser");this.model.setData({selectedUser:"InternalUser",editGroup:false,groupAction:0,selectedGroup:"",firstName:"",lastName:"",email:"",manufacturerNumber:"",MFGName:"",profitCentre:"",salesOrg:"",salesOffice:"",newGroupName:"",groupDetails:{groupList:[]},internalChecklist:[{title:"Create a ServiceNow Request",description:"Use the 'AD Group Membership' request type."},{title:"Enter User's Info",description:"Name, email, and whether they are a new hire or transfer."},{title:"Select Correct AD Group",description:"BTP_INTERNAL_USERS for NAMCK or MFG_INTERNAL_USERS_CA for CA."},{title:"Write a Clear Business Justification",description:"Why this access is needed."},{title:"Approval Path",description:"Manager → Application Owner → AD Group Admin"}],approvalSteps:[{step:"Manager Approval",icon:"sap-icon://employee-approvals"},{step:"Application Owner Approval",icon:"sap-icon://user-settings"},{step:"AD Group Admin Adds User",icon:"sap-icon://shield"}]});this.getView().setModel(this.model,"userContext");debugger;var r=this.getView().getModel("oktaService");console.log("Okta Model from View:",r);if(!r){console.error("❌ OktaService model not found! Check manifest or Component.js");return}r.metadataLoaded().then(function(){console.log("✅ Metadata loaded successfully");this._loadOktaGroups()}.bind(this)).catch(function(e){console.error("❌ Failed to load metadata:",e)});const s=this.byId("internalInstructions");const o=this.byId("internalInstructions1");const i=this.byId("externalUserInfo");const n=this.byId("mfgUserInfo");const a=this.byId("groupUserInfo");s.setHtmlText(`\n            <p>This request ensures your user gets the right access securely and on time.</p>\n  \n            <ul>\n              <li><strong>New Hire or Transfer?</strong> Pick carefully for correct approvals.</li>\n              <li><strong>Domain:</strong> NAMCK (North America) or CA (Canada).</li>\n              <li><strong>AD Group:</strong> BTP_INTERNAL_USERS (NA) or MFG_INTERNAL_USERS_CA (CA).</li>\n              <li><strong>Business Justification:</strong> Keep it clear to avoid delays.</li>\n            </ul>\n    \n          `);o.setHtmlText(`\n              <ol>\n                <li>Manager reviews</li>\n                <li>Application Owner approves</li>\n                <li>AD Group Admin adds the user</li>\n              </ol>\n              <p class="tipText"><strong>Tip: </strong>More Info = <em>Faster Approvals</em></p>\n            `);i.setHtmlText(`\n              <p>Please enter accurate details for the external user. These will be <strong>provisioned to Okta</strong> and may affect downstream systems.</p>\n              <ul>\n                <li><strong>Names</strong> should be spelled exactly as per official documentation.</li>\n                <li><strong>Email</strong> must be a valid, active partner address.</li>\n              </ul>\n              <p class="tipText"><strong>Tip:</strong> Double-check the email for typos. Approval and access links go here!</p>\n            `);n.setHtmlText(`\n              <p>Please enter accurate <strong>manufacturer details</strong>. These are used to filter the user’s data access in the system.</p>\n              <ul>\n                <li>Manufacturer Number & Name must match internal records exactly.</li>\n                <li>Profit Center, Sales Org, and Sales Office affect data visibility and reporting.</li>\n              </ul>\n              <p class="tipText"><strong>Tip:</strong> These values will be validated via backend filters and CDS authorizations, so accuracy is crucial.</p>\n            `);a.setHtmlText(`\n              <p><strong>User groups</strong> define what applications and data the user can access in the Build Work Zone.</p>\n              <ul>\n                <li>Prefer existing groups to keep things clean and consistent.</li>\n                <li>If creating a new group, choose a clear, descriptive name.</li>\n                <li>Groups are managed centrally and tied to application roles.</li>\n              </ul>\n              <p class="tipText"><strong>Tip:</strong> Reach out to your admin team before creating a new group — there may already be one that fits your need!</p>`);this.getView().setModel(this.model);let l=this.getView().getModel("userContext");l.setProperty("/editUserDetails",false);l.setProperty("/editManufacturerDetails",false);l.setProperty("/editGroup",false)},onBeforeRendering:function(){if(!this._groupsLoaded){this._loadOktaGroups();this._groupsLoaded=true}},_loadOktaGroups:function(){var e=this.getView();var t=e.getModel("userContext");var r=e.getModel("oktaService");if(!t){console.error("userContext model not found. Did you set it in onInit?");return}var s=r.bindContext("/getOktaGroups(...)");s.execute().then(function(){var e=s.getBoundContext().getObject();console.log("Fetched Groups:",e);debugger;t.setProperty("/groupDetails/groupList",e);if(e.length){t.setProperty("/selectedGroup",e[2].id)}t.updateBindings(true)}).catch(function(e){console.error("Error fetching groups:",e);sap.m.MessageBox.error("Failed to fetch Okta groups.")})},goToUserStep:function(){debugger;var e=this.model.getProperty("/selectedUser");switch(e){case"ExternalUser":this.byId("UserTypeStep").setNextStep(this.getView().byId("stepExternalDetails"));break;case"InternalUser":default:this.byId("UserTypeStep").setNextStep(this.getView().byId("stepInternalFinal"));break}},setUserMethod:function(){this.setDiscardableProperty({message:"Are you sure you want to change the user type? This will discard your progress.",discardStep:this.byId("UserTypeStep"),modelPath:"/selectedUser",historyPath:"prevUserSelect"})},setDiscardableProperty:function(e){const t=this.model.getProperty(e.modelPath);if(this._wizard.getProgressStep()!==e.discardStep){s.warning(e.message,{actions:[s.Action.YES,s.Action.NO],onClose:function(r){if(r===s.Action.YES){this._wizard.discardProgress(e.discardStep);i[e.historyPath]=t;this.goToUserStep()}else{this.model.setProperty(e.modelPath,i[e.historyPath])}}.bind(this)})}else{i[e.historyPath]=t;this.goToUserStep()}},onWizardReview:function(){debugger;const e=this.getView().getModel("userContext");if(!e){sap.m.MessageToast.show("User context model is missing!");return}const t=e.getProperty("/selectedUser");if(t==="InternalUser"){this._oNavContainer.to(this.byId("internalReviewPage"))}else{let e=this.getView().getModel("userContext");e.setProperty("/editUserDetails",false);e.setProperty("/editManufacturerDetails",false);e.setProperty("/editGroup",false);this._oNavContainer.to(this.byId("externalReviewPage"))}},onFinishInternal:function(){this._oNavContainer.to(this.byId("finishPage"))},onStartOver:function(){var e=this.byId("wizard");this.setUserMethod();this.getView().getModel("userContext").setData({});this.byId("userMethodSelection").setSelectedKey("InternalUser");this._oNavContainer.to(this.byId("wizardContentPage"))},onExitWizard:function(){window.top.location.href="/"},onFetchGroups:function(){var e=this.getView().getModel("oktaService");var t=e.bindContext("/getOktaGroups(...)");t.setParameter("query","MFG");var r=this.getView();t.execute().then(function(){var e=t.getBoundContext().getObject();var s=r.getModel("userContext");s.setProperty("/groupDetails",{groupList:e})}).catch(function(e){console.error("Error fetching groups:",e);sap.m.MessageBox.error("Failed to fetch Okta groups.")})},onSubmitOktaUser:function(){var e=this.getView();var t=e.getModel("userContext").getData();var r={user:{profile:{firstName:t.firstName,lastName:t.lastName,email:t.email,login:t.email,salesOffice:t.salesOffice,profitCentre:t.profitCentre,salesOrg:t.salesOrg,manufacturerNumber:[t.manufacturerNumber],mfgName:t.mfgName},groupIds:["00gkmbbie9xNhlxcb1d7"]}};var s=this.getView().getModel("oktaService");var o=s.bindContext("/createOktaUser(...)");o.setParameter("user",r.user);var i=this;o.execute().then(function(){var e=o.getBoundContext().getObject();sap.m.MessageBox.success(`User created successfully!\nID: ${e.userId}`,{title:"Success",onClose:function(){var e=i.byId("navContainer");e.to(i.byId("finishPage"))}})}).catch(function(e){console.error("Error creating Okta user:",e);sap.m.MessageBox.error("Failed to create user in Okta.")})},onToggleEditUserDetails:function(){let e=this.getView().getModel("userContext");let t=e.getProperty("/editUserDetails");e.setProperty("/editUserDetails",!t)},onToggleEditManufacturerDetails:function(){let e=this.getView().getModel("userContext");let t=e.getProperty("/editManufacturerDetails");e.setProperty("/editManufacturerDetails",!t)},onToggleEditGroup:function(){let e=this.getView().getModel("userContext");let t=e.getProperty("/editGroup");e.setProperty("/editGroup",!t)},_initModel:function(){this.model=new t({externalUserDetails:{firstName:"",lastName:"",email:"",company:"",oktaProvisioning:true},manufacturerDetails:{manufacturerNumber:"",manufacturerName:"",profitCenter:"",salesOrg:"",salesOffice:""},groupDetails:{isNewGroup:false,groupList:["MFG_Reports_Internal","MFG_Reports_All","MFG_Reports_NoPricing","MFG_Reports_NoCashJournal","MFG_Reports_NoInvoiceHistory","MFG_Reports_NoBackOrder","MFG_Reports_NoBKO_NoFinance","MFG_Reports_NoFinance_NoInvoiceHistory","MFG_Reports_NoFinance_NoInvoiceHistory_NoBKO","MFG_Reports_NoAllocation","MFG_Reports_NoPatientId","MFG_Admin","MFG_Cards_NoSalesBy","MFG_Reports_NoFinance","MFG_Reports_All_PivotTable","MFG_Reports_NoFinance_NoInvoiceHistory_NoReturn_NoShipping_RC","MFG_Reports_NoCashJournal_NoReturn_NoShipping","MFG_Reports_BuySell"],selectedGroup:""}});this.getView().setModel(this.model,"userContext")}})});
//# sourceMappingURL=View1.controller.js.map