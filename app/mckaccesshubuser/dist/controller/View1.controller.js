sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/m/WizardStep"],(e,t,r,o,s)=>{"use strict";var a={prevUserSelect:null};return e.extend("mckaccesshubuser.controller.View1",{onInit:function(){this._wizard=this.byId("wizard");this._oNavContainer=this.byId("wizardNavContainer");this._oWizardContentPage=this.byId("wizardContentPage");this._initModel();var e=new sap.ui.model.json.JSONModel;e.loadData("model/manufacturerGroupMap.json");this.getView().setModel(e,"groupMapping");this.model=new t;const r=this.getView().getModel("userContext").getProperty("/selectedGroup");console.log("Selected Group:",r);this.model.setProperty("/selectedUser","InternalUser");this.model.setData({selectedUser:"InternalUser",editGroup:false,groupAction:0,selectedGroup:"",firstName:"",lastName:"",email:"",manufacturerNumber:"",MFGName:"",profitCentre:"",salesOrg:"",salesOffice:"",newGroupName:"",groupDetails:{groupList:[]},internalChecklist:[{title:"Create a ServiceNow Request",description:"Use the 'AD Group Membership' request type."},{title:"Enter User's Info",description:"Name, email, and whether they are a new hire or transfer."},{title:"Select Correct AD Group",description:"BTP_INTERNAL_USERS for NAMCK or MFG_INTERNAL_USERS_CA for CA."},{title:"Write a Clear Business Justification",description:"Why this access is needed."},{title:"Approval Path",description:"Manager → Application Owner → AD Group Admin"}],approvalSteps:[{step:"Manager Approval",icon:"sap-icon://employee-approvals"},{step:"Application Owner Approval",icon:"sap-icon://user-settings"},{step:"AD Group Admin Adds User",icon:"sap-icon://shield"}]});this.getView().setModel(this.model,"userContext");debugger;var o=this.getView().getModel("oktaService");console.log("Okta Model from View:",o);if(!o){console.error("❌ OktaService model not found! Check manifest or Component.js");return}o.metadataLoaded().then(function(){console.log("✅ Metadata loaded successfully");this._loadOktaGroups()}.bind(this)).catch(function(e){console.error("❌ Failed to load metadata:",e)});const s=this.byId("internalInstructions");const a=this.byId("internalInstructions1");const i=this.byId("externalUserInfo");const n=this.byId("mfgUserInfo");const l=this.byId("groupUserInfo");s.setHtmlText(`\n            <p>This request ensures your user gets the right access securely and on time.</p>\n  \n            <ul>\n              <li><strong>New Hire or Transfer?</strong> Pick carefully for correct approvals.</li>\n              <li><strong>Domain:</strong> NAMCK (North America) or CA (Canada).</li>\n              <li><strong>AD Group:</strong> BTP_INTERNAL_USERS (NA) or MFG_INTERNAL_USERS_CA (CA).</li>\n              <li><strong>Business Justification:</strong> Keep it clear to avoid delays.</li>\n            </ul>\n    \n          `);a.setHtmlText(`\n              <ol>\n                <li>Manager reviews</li>\n                <li>Application Owner approves</li>\n                <li>AD Group Admin adds the user</li>\n              </ol>\n              <p class="tipText"><strong>Tip: </strong>More Info = <em>Faster Approvals</em></p>\n            `);i.setHtmlText(`\n              <p>Please enter accurate details for the external user. These will be <strong>provisioned to Okta</strong> and may affect downstream systems.</p>\n              <ul>\n                <li><strong>Names</strong> should be spelled exactly as per official documentation.</li>\n                <li><strong>Email</strong> must be a valid, active partner address.</li>\n              </ul>\n              <p class="tipText"><strong>Tip:</strong> Double-check the email for typos. Approval and access links go here!</p>\n            `);n.setHtmlText(`\n              <p>Please enter accurate <strong>manufacturer details</strong>. These are used to filter the user’s data access in the system.</p>\n              <ul>\n                <li>Manufacturer Number & Name must match internal records exactly.</li>\n                <li>Profit Center, Sales Org, and Sales Office affect data visibility and reporting.</li>\n              </ul>\n              <p class="tipText"><strong>Tip:</strong> These values will be validated via backend filters and CDS authorizations, so accuracy is crucial.</p>\n            `);l.setHtmlText(`\n              <p><strong>User groups</strong> define what applications and data the user can access in the Build Work Zone.</p>\n              <ul>\n                <li>Prefer existing groups to keep things clean and consistent.</li>\n                <li>If creating a new group, choose a clear, descriptive name.</li>\n                <li>Groups are managed centrally and tied to application roles.</li>\n              </ul>\n              <p class="tipText"><strong>Tip:</strong> Reach out to your admin team before creating a new group — there may already be one that fits your need!</p>`);this.getView().setModel(this.model);let u=this.getView().getModel("userContext");u.setProperty("/editUserDetails",false);u.setProperty("/editManufacturerDetails",false);u.setProperty("/editGroup",false)},_loadOktaGroups:function(){var e=this.getView();var t=e.getModel("userContext");var r=e.getModel("oktaService");var o=e.getModel("groupMapping");if(!t||!o){console.error("Required models not found. Did you set them in onInit?");return}var s=r.bindContext("/getOktaGroups(...)");s.execute().then(function(){var e=s.getBoundContext().getObject();var r=e?.value||[];console.log("Fetched Groups:",r);t.setProperty("/groupDetails/groupList",r);t.setProperty("/isGroupMapped",false);var a=r[3];if(a){t.setProperty("/selectedGroup",a.id);console.warn("Defaulting to 3rd group:",a)}var i=t.getProperty("/manufacturerNumber");if(!i){console.warn("Manufacturer number not set. Used default group.");t.updateBindings(true);return}var n=o.getProperty("/mappings")||[];var l=n.find(function(e){return e.manufacturerNumber===i});if(!l){console.warn("No mapping found for manufacturer number:",i);t.updateBindings(true);return}var u=r.find(function(e){return e.id===l.groupId});if(u){t.setProperty("/selectedGroup",u.id);t.setProperty("/isGroupMapped",true);console.log("Auto-selected group:",u)}else{console.warn("Mapped groupId not found. Falling back to default group.")}t.updateBindings(true)}).catch(function(e){console.error("Error fetching groups:",e);sap.m.MessageBox.error("Failed to fetch Okta groups.")})},goToUserStep:function(){debugger;var e=this.model.getProperty("/selectedUser");switch(e){case"ExternalUser":this.byId("UserTypeStep").setNextStep(this.getView().byId("stepExternalDetails"));break;case"InternalUser":default:this.byId("UserTypeStep").setNextStep(this.getView().byId("stepInternalFinal"));break}},goToGroupStep:function(){this._loadOktaGroups()},setUserMethod:function(){this.setDiscardableProperty({message:"Are you sure you want to change the user type? This will discard your progress.",discardStep:this.byId("UserTypeStep"),modelPath:"/selectedUser",historyPath:"prevUserSelect"})},setDiscardableProperty:function(e){const t=this.model.getProperty(e.modelPath);if(this._wizard.getProgressStep()!==e.discardStep){o.warning(e.message,{actions:[o.Action.YES,o.Action.NO],onClose:function(r){if(r===o.Action.YES){this._wizard.discardProgress(e.discardStep);a[e.historyPath]=t;this.goToUserStep()}else{this.model.setProperty(e.modelPath,a[e.historyPath])}}.bind(this)})}else{a[e.historyPath]=t;this.goToUserStep()}},onWizardReview:function(){debugger;const e=this.getView().getModel("userContext");if(!e){sap.m.MessageToast.show("User context model is missing!");return}const t=e.getProperty("/selectedUser");if(t==="InternalUser"){this._oNavContainer.to(this.byId("internalReviewPage"))}else{let e=this.getView().getModel("userContext");e.setProperty("/editUserDetails",false);e.setProperty("/editManufacturerDetails",false);e.setProperty("/editGroup",false);this._oNavContainer.to(this.byId("externalReviewPage"))}},onFinishInternal:function(){this._oNavContainer.to(this.byId("finishPage"))},onStartOver:function(){var e=this.byId("wizard");this.setUserMethod();this.getView().getModel("userContext").setData({});this.byId("userMethodSelection").setSelectedKey("InternalUser");this._oNavContainer.to(this.byId("wizardContentPage"))},onExitWizard:function(){window.top.location.href="/"},onCreateOktaGroup:function(){debugger;var e=this.getView();var t=e.getModel("oktaService");var r=e.getModel("userContext");var o={name:r.getProperty("/newGroupName"),description:"Custom group for MFG user"};var s=t.bindContext("/createOktaGroup(...)");s.setParameter("group",{profile:o});s.execute().then(function(){var e=s.getBoundContext().getObject();r.setProperty("/selectedGroup",e.id);var t=r.getProperty("/groupDetails/groupList")||[];t.push(e);r.setProperty("/groupDetails/groupList",t);sap.m.MessageToast.show("Group created and selected.")}).catch(function(e){console.error("Failed to create group:",e);sap.m.MessageBox.error("Could not create new Okta group.")})},onSubmitOktaUser:function(){var e=this.getView();var t=e.getModel("userContext").getData();var r={user:{profile:{firstName:t.firstName,lastName:t.lastName,email:t.email,login:t.email,salesOffice:t.salesOffice,profitCentre:t.profitCentre,salesOrg:t.salesOrg,manufacturerNumber:[t.manufacturerNumber],mfgName:t.mfgName},groupIds:["00gkmbbie9xNhlxcb1d7"]}};var o=this.getView().getModel("oktaService");var s=o.bindContext("/createOktaUser(...)");s.setParameter("user",r.user);var a=this;s.execute().then(function(){var e=s.getBoundContext().getObject();sap.m.MessageBox.success(`User created successfully!\nID: ${e.userId}`,{title:"Success",onClose:function(){var e=a.byId("navContainer");e.to(a.byId("finishPage"))}})}).catch(function(e){console.error("Error creating Okta user:",e);sap.m.MessageBox.error("Failed to create user in Okta.")})},onToggleEditUserDetails:function(){let e=this.getView().getModel("userContext");let t=e.getProperty("/editUserDetails");e.setProperty("/editUserDetails",!t)},onToggleEditManufacturerDetails:function(){let e=this.getView().getModel("userContext");let t=e.getProperty("/editManufacturerDetails");e.setProperty("/editManufacturerDetails",!t)},onToggleEditGroup:function(){let e=this.getView().getModel("userContext");let t=e.getProperty("/editGroup");e.setProperty("/editGroup",!t)},_initModel:function(){this.model=new t({externalUserDetails:{firstName:"",lastName:"",email:"",company:"",oktaProvisioning:true},manufacturerDetails:{manufacturerNumber:"",manufacturerName:"",profitCenter:"",salesOrg:"",salesOffice:""},groupDetails:{isNewGroup:false,groupList:["MFG_Reports_Internal","MFG_Reports_All","MFG_Reports_NoPricing","MFG_Reports_NoCashJournal","MFG_Reports_NoInvoiceHistory","MFG_Reports_NoBackOrder","MFG_Reports_NoBKO_NoFinance","MFG_Reports_NoFinance_NoInvoiceHistory","MFG_Reports_NoFinance_NoInvoiceHistory_NoBKO","MFG_Reports_NoAllocation","MFG_Reports_NoPatientId","MFG_Admin","MFG_Cards_NoSalesBy","MFG_Reports_NoFinance","MFG_Reports_All_PivotTable","MFG_Reports_NoFinance_NoInvoiceHistory_NoReturn_NoShipping_RC","MFG_Reports_NoCashJournal_NoReturn_NoShipping","MFG_Reports_BuySell"],selectedGroup:""}});this.getView().setModel(this.model,"userContext")}})});
//# sourceMappingURL=View1.controller.js.map