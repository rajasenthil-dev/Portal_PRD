sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox"],(t,e)=>{"use strict";return t.extend("invstatus.controller.View1",{onInit:function(){const t=this.getOwnerComponent().getRouter();t.getRoute("RouteView1").attachPatternMatched(this._onPatternMatched,this);const r=this.getView();const o=r.byId("bar0");r.setBusy(true);o.attachInitialized(function(){r.setBusy(false)});var s=this.getOwnerComponent().getModel();const a=this.getView().byId("table0");const i=a.getTable();this.bAuthorizationErrorShown=false;s.attachRequestFailed(function(t){var r=t.getParameters();if(r.response.statusCode==="403"){i.setNoData("No data available due to authorization restrictions");i.setBusy(false);if(!this.bAuthorizationErrorShown){this.bAuthorizationErrorShown=true;e.error("You do not have the required permissions to access this report.",{title:"Unauthorized Access",id:"messageBoxId1",details:"Permission is required to access this report. Please contact your administrator if you believe this is an error or require access.",contentWidth:"100px"})}}});i.attachEvent("rowsUpdated",this.calculateTotals.bind(this))},_refreshUserModel:async function(){const t=this.getOwnerComponent().getModel("userModel");var e=sap.ui.require.toUrl("invstatus").split("/resources")[0];if(e==="."){e=""}const r=e+"/user-api/attributes";try{const e=await fetch(r);const o=await e.json();t.setData(o);console.log("✅ User model refreshed:",o)}catch(t){console.error("❌ Failed to fetch user info",t)}},_fetchAndSetLogo:function(){const t=this.getView();const e=this.getOwnerComponent().getModel("userModel");const r=e?e.getData():{};const o=r.ManufacturerNumber;const s=t.byId("logoImage");var a=sap.ui.require.toUrl("invstatus").split("/resources")[0];if(a==="."){a=""}const i=a+"/images/MCKCAN1.jpg";if(!o){console.warn("No ManufacturerNumber in user model. Showing fallback logo.");s.setSrc(i);return}const n=this.getOwnerComponent().getModel("logo");const c=new sap.ui.model.Filter("manufacturerNumber","EQ",o);const u=n.bindList("/MediaFile",undefined,undefined,[c]);u.requestContexts().then(function(t){if(t&&t.length>0){const e=t[0].getObject();const r=e.url.replace(/^.*(?=\/odata\/v4\/media)/,"");const o=a+r;s.setSrc(o)}else{console.warn("No matching logo found. Fallback image used.");s.setSrc(i)}}.bind(this)).catch(function(t){console.error("Binding error:",t);s.setSrc(i)}.bind(this))},_onPatternMatched:async function(){await this._refreshUserModel();console.log("RouteView1 pattern matched – fetching logo...");this._fetchAndSetLogo()},calculateTotals:function(){var t=this.getView().byId("table0");var e=t.getTable();var r=e.getBinding("rows");var o=r.getContexts(0,r.getLength());var s=0;var a=0;var i=0;var n=0;var c=0;var u=0;var h=0;var l=0;var d=0;var f=0;o.forEach(function(t){s+=parseFloat(t.getProperty("OPEN_STOCK"))||0;a+=parseFloat(t.getProperty("QUARANTINE"))||0;i+=parseFloat(t.getProperty("RETAINS"))||0;n+=parseFloat(t.getProperty("QUALITY_HOLD"))||0;c+=parseFloat(t.getProperty("RETURNS_CAL"))||0;u+=parseFloat(t.getProperty("RECALLS"))||0;h+=parseFloat(t.getProperty("INVENTORY_HOLD"))||0;l+=parseFloat(t.getProperty("RELABEL_QTY"))||0;d+=parseFloat(t.getProperty("DAMAGE_DESTRUCTION"))||0;f+=parseFloat(t.getProperty("SAMPLE_QTY"))||0});var g=this._formatNumber(s);var m=this._formatNumber(a);var b=this._formatNumber(i);var p=this._formatNumber(n);var v=this._formatNumber(c);var T=this._formatNumber(u);var y=this._formatNumber(h);var N=this._formatNumber(l);var x=this._formatNumber(d);var w=this._formatNumber(f);this.byId("footerText1").setText(g);this.byId("footerText2").setText(m);this.byId("footerText3").setText(b);this.byId("footerText4").setText(p);this.byId("footerText5").setText(v);this.byId("footerText6").setText(T);this.byId("footerText7").setText(y);this.byId("footerText8").setText(N);this.byId("footerText9").setText(x);this.byId("footerText10").setText(w)},_formatNumber:function(t){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t)}})});
//# sourceMappingURL=View1.controller.js.map