sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/json/JSONModel"],(t,e,o)=>{"use strict";return t.extend("invstatus.controller.View1",{onInit(){this._attachRouterPatternMatched();this._initSmartFilterBar();this._initModelErrorHandling();this._attachTableEvents()},_attachRouterPatternMatched(){const t=this.getOwnerComponent().getRouter();t.getRoute("RouteView1").attachPatternMatched(this._onPatternMatched,this)},_initSmartFilterBar(){const t=this.getView();const e=t.byId("bar0");t.setBusy(true);e.attachInitialized(()=>{t.setBusy(false)})},_initModelErrorHandling(){const t=this.getOwnerComponent().getModel();const o=this.getView().byId("table0").getTable();this.bAuthorizationErrorShown=false;t.attachRequestFailed(t=>{const{statusCode:r}=t.getParameters().response;if(r==="403"){o.setNoData("No data available due to authorization restrictions");o.setBusy(false);if(!this.bAuthorizationErrorShown){this.bAuthorizationErrorShown=true;e.error("You do not have the required permissions to access this report.",{title:"Unauthorized Access",id:"messageBoxId1",details:"Permission is required to access this report. Please contact your administrator if you believe this is an error or require access.",contentWidth:"100px"})}}})},_attachTableEvents(){const t=this.getView().byId("table0").getTable();t.attachEvent("rowsUpdated",this.calculateTotals.bind(this))},async _refreshUserModel(){const t=this.getOwnerComponent().getModel("userModel");let e=sap.ui.require.toUrl("invstatus").split("/resources")[0];e=e==="."?"":e;const o=`${e}/user-api/attributes`;try{const e=await fetch(o);const r=await e.json();t.setData(r);console.log("✅ User model refreshed:",r)}catch(t){console.error("❌ Failed to fetch user info",t)}},_fetchAndSetLogo(){const t=this.getView();const e=this.getOwnerComponent().getModel("userModel");const r=e?.getData()||{};const s=r.ManufacturerNumber;const n=t.byId("logoImage");let i=sap.ui.require.toUrl("invstatus").split("/resources")[0];i=i==="."?"":i;const a=`${i}/images/MCKCAN1.jpg`;if(!s){console.warn("No ManufacturerNumber in user model. Showing fallback logo.");n.setSrc(a);return}const c=this.getOwnerComponent().getModel("logo");const l=new o("manufacturerNumber","EQ",s);const u=c.bindList("/MediaFile",undefined,undefined,[l]);u.requestContexts().then(t=>{if(t?.length>0){const e=t[0].getObject();const o=e.url.replace(/^.*(?=\/odata\/v4\/media)/,"");const r=`${i}${o}`;n.setSrc(r)}else{console.warn("No matching logo found. Fallback image used.");n.setSrc(a)}}).catch(t=>{console.error("Binding error:",t);n.setSrc(a)})},async _onPatternMatched(){await this._refreshUserModel();console.log("RouteView1 pattern matched – fetching logo...");this._fetchAndSetLogo()},calculateTotals:function(){const t=this.getView().byId("table0").getTable();const e=t.getBinding("rows");const o=e.getContexts(0,e.getLength());const r=this.getOwnerComponent().getModel("i18n").getResourceBundle();const s=[{prop:"OPEN_STOCK",icon:"sap-icon://inventory",color:"Positive"},{prop:"QUARANTINE",icon:"sap-icon://alert",color:"Critical"},{prop:"RETAINS",icon:"sap-icon://save",color:"Neutral"},{prop:"QUALITY_HOLD",icon:"sap-icon://synchronize",color:"Critical"},{prop:"RETURNS_CAL",icon:"sap-icon://undo",color:"Neutral"},{prop:"RECALLS",icon:"sap-icon://reset",color:"Negative"},{prop:"INVENTORY_HOLD",icon:"sap-icon://shelf",color:"Critical"},{prop:"RELABEL_QTY",icon:"sap-icon://tag",color:"Neutral"},{prop:"DAMAGE_DESTRUCTION",icon:"sap-icon://delete",color:"Negative"},{prop:"SAMPLE_QTY",icon:"sap-icon://lab",color:"Neutral"},{prop:"IN_PROCESS",icon:"sap-icon://process",color:"Positive"},{prop:"TOTAL_QTY",icon:"sap-icon://sum",color:"Positive"}];const n=s.map(t=>{const e=o.reduce((e,o)=>e+(parseFloat(o.getProperty(t.prop))||0),0);return{key:t.prop,label:r.getText(t.prop),value:this._formatNumber(e),icon:t.icon,color:t.color}});const i=new sap.ui.model.json.JSONModel(n);this.getView().setModel(i,"totals")},_formatNumber(t){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t)}})});
//# sourceMappingURL=View1.controller.js.map