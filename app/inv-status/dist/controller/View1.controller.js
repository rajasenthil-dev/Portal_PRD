sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/Filter"],(t,e,o)=>{"use strict";return t.extend("invstatus.controller.View1",{onInit(){this._attachRouterPatternMatched();this._initSmartFilterBar();this._initModelErrorHandling();this._attachTableEvents()},_attachRouterPatternMatched(){const t=this.getOwnerComponent().getRouter();t.getRoute("RouteView1").attachPatternMatched(this._onPatternMatched,this)},_initSmartFilterBar(){const t=this.getView();const e=t.byId("bar0");t.setBusy(true);e.attachInitialized(()=>{t.setBusy(false)})},_initModelErrorHandling(){const t=this.getOwnerComponent().getModel();const o=this.getView().byId("table0").getTable();this.bAuthorizationErrorShown=false;t.attachRequestFailed(t=>{const{statusCode:r}=t.getParameters().response;if(r==="403"){o.setNoData("No data available due to authorization restrictions");o.setBusy(false);if(!this.bAuthorizationErrorShown){this.bAuthorizationErrorShown=true;e.error("You do not have the required permissions to access this report.",{title:"Unauthorized Access",id:"messageBoxId1",details:"Permission is required to access this report. Please contact your administrator if you believe this is an error or require access.",contentWidth:"100px"})}}})},_attachTableEvents(){const t=this.getView().byId("table0").getTable();t.attachEvent("rowsUpdated",this.calculateTotals.bind(this))},async _refreshUserModel(){const t=this.getOwnerComponent().getModel("userModel");let e=sap.ui.require.toUrl("invstatus").split("/resources")[0];e=e==="."?"":e;const o=`${e}/user-api/attributes`;try{const e=await fetch(o);const r=await e.json();t.setData(r);console.log("✅ User model refreshed:",r)}catch(t){console.error("❌ Failed to fetch user info",t)}},_fetchAndSetLogo(){const t=this.getView();const e=this.getOwnerComponent().getModel("userModel");const r=e?.getData()||{};const s=r.ManufacturerNumber;const a=t.byId("logoImage");let n=sap.ui.require.toUrl("invstatus").split("/resources")[0];n=n==="."?"":n;const i=`${n}/images/MCKCAN1.jpg`;if(!s){console.warn("No ManufacturerNumber in user model. Showing fallback logo.");a.setSrc(i);return}const c=this.getOwnerComponent().getModel("logo");const l=new o("manufacturerNumber","EQ",s);const d=c.bindList("/MediaFile",undefined,undefined,[l]);d.requestContexts().then(t=>{if(t?.length>0){const e=t[0].getObject();const o=e.url.replace(/^.*(?=\/odata\/v4\/media)/,"");const r=`${n}${o}`;a.setSrc(r)}else{console.warn("No matching logo found. Fallback image used.");a.setSrc(i)}}).catch(t=>{console.error("Binding error:",t);a.setSrc(i)})},async _onPatternMatched(){await this._refreshUserModel();console.log("RouteView1 pattern matched – fetching logo...");this._fetchAndSetLogo()},calculateTotals(){const t=this.getView().byId("table0").getTable();const e=t.getBinding("rows");const o=e.getContexts(0,e.getLength());const r=[{prop:"OPEN_STOCK",footerId:"footerText1"},{prop:"QUARANTINE",footerId:"footerText2"},{prop:"RETAINS",footerId:"footerText3"},{prop:"QUALITY_HOLD",footerId:"footerText4"},{prop:"RETURNS_CAL",footerId:"footerText5"},{prop:"RECALLS",footerId:"footerText6"},{prop:"INVENTORY_HOLD",footerId:"footerText7"},{prop:"RELABEL_QTY",footerId:"footerText8"},{prop:"DAMAGE_DESTRUCTION",footerId:"footerText9"},{prop:"SAMPLE_QTY",footerId:"footerText10"}];const s=r.map(t=>o.reduce((e,o)=>e+(parseFloat(o.getProperty(t.prop))||0),0));r.forEach((t,e)=>{const o=this._formatNumber(s[e]);this.byId(t.footerId).setText(o)})},_formatNumber(t){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t)}})});
//# sourceMappingURL=View1.controller.js.map