sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/core/format/NumberFormat"],(e,t,r)=>{"use strict";return e.extend("openorders.controller.View1",{_bFilterBarInitialized:false,onInit:async function(){this._bFilterBarInitialized=false;var e=this.getOwnerComponent().getModel();const r=this.getView();const i=r.byId("bar0");r.setBusy(true);i.attachInitialized(function(){r.setBusy(false)});const n=this.getView().byId("table0");const o=n.getTable();this.bAuthorizationErrorShown=false;e.attachRequestFailed(function(e){var r=e.getParameters();if(r.response.statusCode==="403"){o.setNoData("No data available due to authorization restrictions");o.setBusy(false);if(!this.bAuthorizationErrorShown){this.bAuthorizationErrorShown=true;t.error("You do not have the required permissions to access this report.",{title:"Unauthorized Access",id:"messageBoxId1",details:"Permission is required to access this report. Please contact your administrator if you believe this is an error or require access.",contentWidth:"100px"})}}});const s=this.getOwnerComponent().getModel("userModel");const a=s?s.getData():{};const l=a.ManufacturerNumber;const c=this.getOwnerComponent().getModel("logo");var u=sap.ui.require.toUrl("openorders").split("/resources")[0];if(u==="."){u=""}const d=u+"/images/MCKCAN1.jpg";if(!l){console.warn("No ManufacturerNumber in user model. Showing fallback logo.");r.byId("logoImage").setSrc(d);return}const g=new sap.ui.model.Filter("manufacturerNumber","EQ",l);const f=c.bindList("/MediaFile",undefined,undefined,[g]);f.requestContexts().then(function(e){if(e&&e.length>0){const t=e[0].getObject();const i=t.url.replace(/^.*(?=\/odata\/v4\/media)/,"");const n=u+i;r.byId("logoImage").setSrc(n)}else{console.warn("No matching logo found. Fallback image used.");r.byId("logoImage").setSrc(d)}}.bind(this)).catch(function(e){console.error("Binding error:",e);r.byId("logoImage").setSrc(d)}.bind(this));o.attachEvent("rowsUpdated",this._calculateTotals.bind(this))},onAfterRendering:function(){if(!this._bFilterBarInitialized){var e=this.byId("bar0");if(e){console.log("Setting FilterBar busy in onAfterRendering");e.setBusy(true)}}},onFilterBarInitialised:function(e){console.log("FilterBar initialise event fired");var t=e.getSource();t.setBusy(false);this._bFilterBarInitialized=true},onBeforeRebindTable:function(e){var t=this.byId("table0");t.setBusy(true);var r=e.getParameter("bindingParams");r.events=r.events||{};r.events.dataReceived=function(e){t.setBusy(false)}.bind(this)},_calculateTotals:function(e){var t=r.getIntegerInstance({groupingEnabled:true});var i=r.getFloatInstance({groupingEnabled:true,maxFractionDigits:3,minFractionDigits:0});var n=e.getSource();var o=n.getBinding("rows");if(o){var s=o.getLength();var a=o.getContexts(0,s);var l=s;var c=0;var u=new Set;if(a&&a.length>0){a.forEach(function(e){var t=e.getProperty("KWMENG");c+=parseFloat(t)||0;var r=e.getProperty("VBELN");if(r!==null&&r!==undefined){u.add(r)}})}var d=u.size;var g=t.format(l);var f=t.format(d);var h=i.format(c);this.byId("_IDGenNumericContent1").setText(g);this.byId("_IDGenNumericContent2").setText(f);this.byId("footerText1").setText(h)}else{this.byId("_IDGenNumericContent1").setText("0");this.byId("_IDGenNumericContent2").setText("0");this.byId("footerText1").setText("0");console.error("Row binding not found for table.")}}})});
//# sourceMappingURL=View1.controller.js.map