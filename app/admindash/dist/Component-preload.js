//@ui5-bundle admindash/Component-preload.js
sap.ui.require.preload({
	"admindash/Component.js":function(){
sap.ui.define(["sap/ui/core/UIComponent","admindash/model/models"],(e,t)=>{"use strict";return e.extend("admindash.Component",{metadata:{manifest:"json",interfaces:["sap.ui.core.IAsyncContentCreation"]},init(){e.prototype.init.apply(this,arguments);this.setModel(t.createDeviceModel(),"device");this.getRouter().initialize()}})});
},
	"admindash/controller/App.controller.js":function(){
sap.ui.define(["sap/ui/core/mvc/Controller"],e=>{"use strict";return e.extend("admindash.controller.App",{onInit(){}})});
},
	"admindash/controller/View1.controller.js":function(){
sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/core/format/FileSizeFormat","sap/m/MessageBox"],function(e,t,r,a,i){"use strict";return e.extend("admindash.controller.View1",{onInit:function(){this.oUploadSet=this.byId("fileUploader");this._oModel=this.getOwnerComponent().getModel();this.getView().setModel(new r({fileData:null,csrfToken:null,manufacturerNumber:"",mfgName:"",existingManufacturers:[],existingMfgNames:[]}),"ui");this._binding=null;this._fetchExistingManufacturers()},onBeforeRendering:function(){this._fetchCSRFToken()},_fetchExistingManufacturers:function(){var e=sap.ui.require.toUrl("admindash").split("/resources")[0];if(e==="."){e=""}return fetch(e+"/odata/v4/media/MediaFile").then(e=>e.json()).then(e=>{var t=e.value.map(e=>e.manufacturerNumber);var r=e.value.map(e=>e.MFGName);this.getView().getModel("ui").setProperty("/existingManufacturers",t);this.getView().getModel("ui").setProperty("/existingMfgNames",r)}).catch(e=>console.error("Error fetching manufacturers:",e))},onChange:function(e){var t=e.getParameter("files")?.[0];var r=this.getView().getModel("ui");if(t){r.setProperty("/fileData",{file:t,fileName:t.name,fileSize:a.getInstance({binaryFilesize:false,maxFractionDigits:1,maxIntegerDigits:3}).format(t.size),fileType:t.type})}else{r.setProperty("/fileData",null)}},onOpenDialog:function(){this.getView().byId("addManufacturerDialog").open()},onCloseDialog:function(){this.getView().byId("addManufacturerDialog").close()},onUploadPress:async function(){var e=this.getView().getModel("ui");var t=e.getProperty("/fileData/file");var r=e.getProperty("/manufacturerNumber");var a=e.getProperty("/mfgName");var o=e.getProperty("/csrfToken");var n=e.getProperty("/existingManufacturers").map(e=>e.toLowerCase());var s=e.getProperty("/existingMfgNames").map(e=>e.toLowerCase());if(n.includes(r.toLowerCase())){i.error("This Manufacturer Number already exists.");return}if(s.includes(a.toLowerCase())){i.error("This Manufacturer Name already exists.");return}if(!this._validateUploadInputs(r,a,t))return;try{if(!this._binding){const e=await this._createDraft(r,a,t.name,t.type,o);if(e?.context){this._binding=this.getView().getModel().bindContext(e.context.getPath(),null,{$$updateGroupId:"UploadGroup"})}}await this._updateDraftWithContent(this._binding.getPath(),t,t.type,t.name,o);await this._activateDraft(this._binding.getPath(),o);i.success("File uploaded successfully.");this._resetForm();this.onCloseDialog()}catch(e){i.error("Error during upload process: "+e.message)}},_fetchCSRFToken:function(){var e=sap.ui.require.toUrl("admindash").split("/resources")[0];if(e==="."){e=""}return fetch(e+"/odata/v4/media/",{method:"GET",headers:{"X-CSRF-Token":"Fetch"}}).then(e=>{if(!e.ok)throw new Error("Failed to fetch CSRF token");this.getView().getModel("ui").setProperty("/csrfToken",e.headers.get("x-csrf-token"))}).catch(e=>console.error("Error fetching CSRF token: ",e))},_validateUploadInputs:function(e,t,r){if(!e)return i.error("Please enter a Manufacturer Number."),false;if(!t)return i.error("Please enter an MFG Name."),false;if(!r)return i.error("Please choose a file to upload."),false;return true},_resetForm:function(){var e=this.getView().getModel("ui");this.byId("fileUploader").clear();e.setProperty("/fileData",null);e.setProperty("/manufacturerNumber","");e.setProperty("/mfgName","");this.getView().getModel().refresh();this._binding=null;this.byId("idMediaFilesTable").removeSelections(true)},_createDraft:function(e,t,r,a,i){var o=sap.ui.require.toUrl("admindash").split("/resources")[0];if(o==="."){o=""}return fetch(o+"/odata/v4/media/MediaFile",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":i},body:JSON.stringify({manufacturerNumber:e,MFGName:t,fileName:r,mediaType:a})}).then(e=>e.json()).then(e=>({context:{getPath:()=>`/MediaFile(ID=${e.ID},IsActiveEntity=false)`}})).catch(e=>{throw new Error("Failed to create draft: "+e.message)})},_updateDraftWithContent:async function(e,t,r,a,o){try{const i=await fetch(this._oModel.sServiceUrl+e+"/content",{method:"PUT",headers:{"X-CSRF-Token":o,"Content-Type":r,slug:a},body:t});console.log("Server Response Status:",i.status);if(!i.ok){throw new Error(`Failed to upload file. Server responded with status: ${i.status}`)}let n=null;let s=null;if(i.status===204){console.warn("Server returned 204 No Content. Constructing file URL manually...")}else{const e=await i.text();console.log("Raw server response:",e);if(e){try{const t=JSON.parse(e);s=t?.ID}catch(e){console.warn("Response is not valid JSON.")}}}let l=e.replace("IsActiveEntity=false","IsActiveEntity=true");n=this._oModel.sServiceUrl+l+"/content";console.log("Final file URL:",n);this.getView().getModel("ui").setProperty("/fileData/fileUrl",n);const u=await fetch(this._oModel.sServiceUrl+e,{method:"PATCH",headers:{"X-CSRF-Token":o,"Content-Type":"application/json"},body:JSON.stringify({url:n})});if(!u.ok){throw new Error(`Failed to update file URL in backend. Status: ${u.status}`)}console.log("✅ File URL successfully updated in backend.")}catch(e){console.error("Upload error:",e.message);i.error("Upload error: "+e.message)}},_activateDraft:function(e,t){var r=sap.ui.require.toUrl("admindash").split("/resources")[0];if(r==="."){r=""}return fetch(`${r}/odata/v4/media${e}/Media.draftActivate`,{method:"POST",headers:{"X-CSRF-Token":t,"Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw new Error("Failed to activate draft")}).catch(e=>{throw new Error("Error activating draft: "+e.message)})},onTypeMissmatch:function(){i.error("Invalid file type. Allowed types are: txt, pdf, docx, jpg, png, jpeg")},onManufacturerNumberLiveChange:function(e){var t=e.getParameter("value");var r=e.getSource();var a=this.getView().getModel("ui");var i=a.getProperty("/existingManufacturers");if(/[a-zA-Z]/.test(t)){r.setValueState("Error");r.setValueStateText("Manufacturer Number should not contain letters.")}else{r.setValueState("None")}if(i.includes(t)){r.setValueState("Error");r.setValueStateText("This Manufacturer Number already exists.")}else{r.setValueState("None")}},onManufacturerNameLiveChange:function(e){var t=e.getParameter("value");var r=e.getSource();var a=this.getView().getModel("ui");var i=a.getProperty("/existingMfgNames").map(e=>e.toLowerCase());if(i.includes(t)){r.setValueState("Error");r.setValueStateText("This Manufacturer Name already exists.")}else{r.setValueState("None")}},onDeleteDraft:function(){var e=this.byId("idMediaFilesTable");var t=e.getSelectedItems();if(!t.length){i.warning("Please select at least one draft to delete.");return}i.warning("Make sure ONLY entries you want to delete are selected. Once deleted, this action cannot be undone.",{actions:[i.Action.OK,i.Action.CANCEL],emphasizedAction:i.Action.OK,onClose:e=>{if(e===i.Action.OK){this._deleteDrafts(t)}}})},_deleteDrafts:function(e){var r=this.getView().getModel();var a=[];e.forEach(e=>{var t=e.getBindingContext();a.push(t.delete())});Promise.all(a).then(()=>{t.show("Selected items deleted successfully.");r.refresh()}).catch(e=>{i.error("Error deleting items: "+e.message)})}})});
},
	"admindash/i18n/i18n.properties":'# This is the resource bundle for admindash\n\n#Texts for manifest.json\n\n#XTIT: Application name\nappTitle=Admin Dashboard\n\n#YDES: Application description\nappDescription=An SAP Fiori application.\n#XTIT: Main view title\ntitle=Admin Dashboard\n\n#XFLD,45\nflpTitle=Admin Dashboard\n\nmanufacturerNumberError=Manufacturer Number cannot contain letters.\n\n\nuploadPageTitle=Admin Dashboard\nfileUploaderPlaceholder=Choose a file...\nuploadButtonText=Upload\n\nmanufacturerNumberLabel=Manufacturer Number\nmanufacturerNumberPlaceholder=Enter Manufacturer Number\nmfgNameLabel=MFG Name\nmfgNamePlaceholder=Enter MFG Name\nmfgUploadLabel=Upload Logo\n',
	"admindash/manifest.json":'{"_version":"1.65.0","sap.app":{"id":"admindash","type":"application","i18n":"i18n/i18n.properties","applicationVersion":{"version":"0.0.1"},"title":"{{appTitle}}","description":"{{appDescription}}","resources":"resources.json","sourceTemplate":{"id":"@sap/generator-fiori:basic","version":"1.16.3","toolsId":"97e56c45-d7a2-46fa-8971-7bf494c123ff"},"dataSources":{"mainService":{"uri":"odata/v4/media/","type":"OData","settings":{"annotations":[],"odataVersion":"4.0"}}},"crossNavigation":{"inbounds":{"Dashboard-display":{"semanticObject":"Dashboard","action":"display","title":"{{flpTitle}}","signature":{"parameters":{},"additionalParameters":"allowed"}}}}},"sap.ui":{"technology":"UI5","icons":{"icon":"","favIcon":"","phone":"","phone@2":"","tablet":"","tablet@2":""},"deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"flexEnabled":true,"dependencies":{"minUI5Version":"1.132.1","libs":{"sap.m":{},"sap.ui.core":{}}},"contentDensities":{"compact":true,"cozy":true},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","settings":{"bundleName":"admindash.i18n.i18n"}},"":{"dataSource":"mainService","preload":true,"settings":{"operationMode":"Server","autoExpandSelect":true,"earlyRequests":true}}},"resources":{"css":[{"uri":"css/style.css"}]},"routing":{"config":{"routerClass":"sap.m.routing.Router","controlAggregation":"pages","controlId":"app","transition":"slide","type":"View","viewType":"XML","path":"admindash.view"},"routes":[{"name":"RouteView1","pattern":":?query:","target":["TargetView1"]}],"targets":{"TargetView1":{"id":"View1","name":"View1"}}},"rootView":{"viewName":"admindash.view.App","type":"XML","id":"App"}},"sap.cloud":{"public":true,"service":"mck.portal"}}',
	"admindash/model/formatter.js":function(){
sap.ui.define([],()=>{"use strict";return{formatUrl:function(r){if(!r)return"";var e=sap.ui.require.toUrl("admindash").split("/resources")[0];if(e==="."){e=""}console.log("✅ Dynamic Base Path:",e);var i=e+r;return i}}});
},
	"admindash/model/models.js":function(){
sap.ui.define(["sap/ui/model/json/JSONModel","sap/ui/Device"],function(e,n){"use strict";return{createDeviceModel:function(){var i=new e(n);i.setDefaultBindingMode("OneWay");return i}}});
},
	"admindash/view/App.view.xml":'<mvc:View controllerName="admindash.controller.App"\n    displayBlock="true"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"><App id="app"></App></mvc:View>',
	"admindash/view/View1.view.xml":'<mvc:View controllerName="admindash.controller.View1"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    xmlns:core="sap.ui.core"\n    xmlns:u="sap.ui.unified"><Page title="{i18n>uploadPageTitle}"><content><Table id="idMediaFilesTable"\n                inset="false"\n                mode="MultiSelect"\n                items="{\n                    path: \'/MediaFile\'\n                }"><headerToolbar><OverflowToolbar><content><Title text="Manufacturer Details" level="H2"/><ToolbarSpacer /><Button text="Add New Manufacturer" press="onOpenDialog" type="Emphasized" /><Button text="Delete Entries" press=".onDeleteDraft" type="Reject" /></content></OverflowToolbar></headerToolbar><columns><Column><Text text="Manufacturer Number" /></Column><Column><Text text="Manufacturer Name" /></Column><Column><Text text="File Name" /></Column><Column><Text text="Logo" /></Column></columns><items><ColumnListItem vAlign="Middle"><cells><Text text="{manufacturerNumber}" /><Text text="{MFGName}" /><Text text="{fileName}" /><Image \n                                core:require="{\n                                    Formatter: \'admindash/model/formatter\'\n                                }" \n                                id="logoImage" \n                                src="{path: \'url\', formatter: \'Formatter.formatUrl.bind($controller)\'}" \n                                alt="{fileName}" \n                                width="100px" /></cells></ColumnListItem></items></Table><Dialog id="addManufacturerDialog" title="Add Manufacturer" stretch="true" class="sapUiSizeCompact" \n                afterClose="onCloseDialog"><content><VBox class="dialogContent sapUIMarginMedium" justifyContent="SpaceBetween" width="100%"><Label text="{i18n>manufacturerNumberLabel}" labelFor="manufacturerNumberInput" /><Input id="manufacturerNumberInput" value="{ui>/manufacturerNumber}" \n                            valueStateText="{i18n>manufacturerNumberError}" \n                            placeholder="{i18n>manufacturerNumberPlaceholder}" required="true"\n                            liveChange=".onManufacturerNumberLiveChange" width="100%" class="dialogInput"/><Label text="{i18n>mfgNameLabel}" labelFor="mfgNameInput" /><Input id="mfgNameInput" value="{ui>/mfgName}" \n                            valueStateText="{i18n>manufacturerNameError}" \n                            placeholder="{i18n>mfgNamePlaceholder}" required="true" \n                            liveChange=".onManufacturerNameLiveChange" width="100%" class="dialogInput"/><Label text="{i18n>mfgUploadLabel}" labelFor="mfgLogoUpload" /><u:FileUploader id="fileUploader" name="myFile" \n                            placeholder="{i18n>fileUploaderPlaceholder}" \n                            change="onChange" \n                            typeMissmatch="onFileTypeMismatch" width="100%" class="dialogFileUploader"/></VBox></content><buttons><Button text="Submit" press="onUploadPress" width="100px"/><Button text="Cancel" press="onCloseDialog" width="100px"/></buttons></Dialog></content></Page></mvc:View>'
});
//# sourceMappingURL=Component-preload.js.map
