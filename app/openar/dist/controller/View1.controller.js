sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/Dialog","sap/m/Button","sap/m/Image"],(t,e,n,o)=>{"use strict";return t.extend("openar.controller.View1",{onInit:function(){var t=this.byId("table");var e=this.getOwnerComponent().getModel();t.setModel(e);t.attachEvent("rowsUpdated",this._calculateFooterAndSummary.bind(this))},_onTableUpdate:function(){debugger;this._calculateFooterAndSummary()},_calculateFooterAndSummary:function(){var t=this.byId("table");var e=t.getBinding("rows");var n=e.getContexts(0,e.getLength());if(!e)return;var o={fTotCurrent:0,fTot1to30:0,fTot31to60:0,fTot61to90:0,fTotOver90:0,fTotInvoice:0,fTotAmountPaid:0};n.forEach(function(t){o.fTotCurrent+=this._getValueOrZero(t,"CAL_CURRENT");o.fTot1to30+=this._getValueOrZero(t,"CAL_1_30");o.fTot31to60+=this._getValueOrZero(t,"CAL_31_60");o.fTot61to90+=this._getValueOrZero(t,"CAL_61_90");o.fTotOver90+=this._getValueOrZero(t,"CAL_OVER_90");o.fTotInvoice+=this._getValueOrZero(t,"NETWR");o.fTotAmountPaid+=this._getValueOrZero(t,"TSL")},this);Object.keys(o).forEach(function(t){var e=this._formatCurrency(o[t]);this.byId("footerText"+this._getFooterIndex(t)).setText(e)},this);var r=[o.fTotCurrent,o.fTot1to30,o.fTot31to60,o.fTot61to90,o.fTotOver90];var a=r.reduce((t,e)=>t+e,0);var i=a===0?[0,0,0,0,0]:r.map(t=>t/a*100);this._updateDonutChart(i);this._updatePastDue(n);this._updateBalanceOwed(o.fTotInvoice,o.fTotAmountPaid);this._updateOpenInvoices(n);this._updateAvgAge(t)},_getValueOrZero:function(t,e){var n=t.getProperty(e);return n?parseFloat(n):0},_formatCurrency:function(t){if(t==null||t===undefined){return""}var e=sap.ui.getCore().getConfiguration().getLocale().getLanguage();var n;switch(e){case"en-US":n="USD";break;case"en-CA":n="CAD";break;case"fr-CA":n="CAD";break;default:n="USD";break}var o=sap.ui.core.format.NumberFormat.getCurrencyInstance({currencyCode:false,customCurrencies:{MyDollar:{isoCode:n,decimals:2}},groupingEnabled:true,showMeasure:true});return o.format(t,"MyDollar")},_getFooterIndex:function(t){var e={fTotCurrent:1,fTot1to30:2,fTot31to60:3,fTot61to90:4,fTotOver90:5,fTotInvoice:6,fTotAmountPaid:7};return e[t]||0},_updateDonutChart:function(t){var e=["_IDGenInteractiveDonutChartSegment","_IDGenInteractiveDonutChartSegment1","_IDGenInteractiveDonutChartSegment2","_IDGenInteractiveDonutChartSegment3","_IDGenInteractiveDonutChartSegment4"];e.forEach(function(e,n){this.byId(e).setValue(t[n]);this.byId(e).setDisplayedValue(t[n].toFixed(2)+"%")},this)},_updatePastDue:function(t){var e=0;t.forEach(function(t){var n=t.getObject();var o=n.NETDT?this._formatDate(n.NETDT):null;if(!o){return}var r=new Date;var a=n.NETWR-n.TSL;if(r>o&&a>0){e+=a}},this);var n=this._formatAmount(e);this.byId("_IDGenNumericContent2").setText(n)},_updateBalanceOwed:function(t,e){var n=t-e;var o=this._formatAmount(n);this.byId("_IDGenNumericContent1").setText(o)},_updateOpenInvoices:function(t){var e=t.filter(function(t){var e=t.getObject();var n=e.NETWR-e.TSL;return n>0}).length;this.byId("_IDGenNumericContent5").setText(e)},_updateAvgAge:function(t){var e=t.getBinding("rows");if(!e)return 0;var n=e.getContexts().map(function(t){return t.getObject()});var o=n.reduce(function(t,e){return t+(e.CAL_AGE||0)},0)/n.length;this.byId("_IDGenNumericContent4").setText(o.toFixed(1))},_formatAmount:function(t){if(t>=1e6)return"$"+(t/1e6).toFixed(2)+"M";if(t>=1e3)return"$"+(t/1e3).toFixed(2)+"K";return"$"+t.toFixed(2)},_formatDate:function(t){if(!t)return"";let e;if(typeof t==="string"){if(t.length===8){const n=t.slice(0,4)+"-"+t.slice(4,6)+"-"+t.slice(6,8);e=new Date(n+"T00:00:00Z")}else{return""}}else if(t instanceof Date){e=new Date(t.getTime())}else{return""}if(isNaN(e.getTime())){return""}e.setMinutes(e.getMinutes()+e.getTimezoneOffset());const n=sap.ui.core.format.DateFormat.getDateInstance({style:"medium"});return n.format(e)},onInvoiceClick:function(t){const e=t.getSource().getText();const n=`/mock-api/invoices/${e}`;this._fetchInvoiceImage(n).then(t=>this._showInvoiceDialog(t)).catch(t=>sap.m.MessageToast.show("Failed to load invoice"))},_fetchInvoiceImage:function(t){return new Promise((t,e)=>{setTimeout(()=>{t("https://via.placeholder.com/600x800.png?text=Invoice")},1e3)})},_showInvoiceDialog:function(t){const r=new e({title:"Invoice",content:new o({src:t,width:"100%"}),buttons:[new n({text:"Download",press:()=>this._downloadImage(t)}),new n({text:"Print",press:()=>this._printImage(t)}),new n({text:"Close",press:function(){r.close()}})]});r.open()},_downloadImage:function(t){const e=document.createElement("a");e.href=t;e.download="invoice.png";e.click()},_printImage:function(t){const e=window.open("");e.document.write(`<img src='${t}' style='width:100%;'/>`);e.print();e.close()}})});
//# sourceMappingURL=View1.controller.js.map