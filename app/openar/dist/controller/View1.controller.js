sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/Dialog","sap/m/Button","sap/m/Image","sap/m/MessageBox"],(t,e,o,n,r)=>{"use strict";return t.extend("openar.controller.View1",{onInit:function(){var t=this.getOwnerComponent().getModel();const e=this.getView().byId("table0");const o=e.getTable();this.bAuthorizationErrorShown=false;t.attachRequestFailed(function(t){var e=t.getParameters();if(e.response.statusCode==="403"){o.setNoData("No data available due to authorization restrictions");o.setBusy(false);if(!this.bAuthorizationErrorShown){this.bAuthorizationErrorShown=true;r.error("You do not have the required permissions to access this report.",{title:"Unauthorized Access",id:"messageBoxId1",details:"Permission is required to access this report. Please contact your administrator if you believe this is an error or require access.",contentWidth:"100px"})}}});var n=this.getOwnerComponent().getModel("logo");var i=n.bindList("/MediaFile");i.requestContexts().then(function(t){if(t.length>0){var e=t[0].getObject();console.log("Manufacturer:",e.MFGName);console.log("File URL:",e.url);var o=sap.ui.require.toUrl("openar").split("/resources")[0];if(o==="."){o=""}console.log("âœ… Dynamic Base Path:",o);var n=o+e.url;this.getView().byId("logoImage").setSrc(n)}else{console.log("No media found for this manufacturer.")}}.bind(this));o.setModel(t);o.attachEvent("rowsUpdated",this._calculateFooterAndSummary.bind(this))},_onTableUpdate:function(){this._calculateFooterAndSummary()},_calculateFooterAndSummary:function(){var t=this.byId("table");var e=t.getBinding("rows");var o=e.getContexts(0,e.getLength());if(!e)return;var n={fTotCurrent:0,fTot1to30:0,fTot31to60:0,fTot61to90:0,fTotOver90:0,fTotInvoice:0,fTotAmountPaid:0};o.forEach(function(t){n.fTotCurrent+=this._getValueOrZero(t,"CAL_CURRENT");n.fTot1to30+=this._getValueOrZero(t,"CAL_1_30");n.fTot31to60+=this._getValueOrZero(t,"CAL_31_60");n.fTot61to90+=this._getValueOrZero(t,"CAL_61_90");n.fTotOver90+=this._getValueOrZero(t,"CAL_OVER_90");n.fTotInvoice+=this._getValueOrZero(t,"NETWR");n.fTotAmountPaid+=this._getValueOrZero(t,"TSL")},this);Object.keys(n).forEach(function(t){var e=this._formatCurrency(n[t]);this.byId("footerText"+this._getFooterIndex(t)).setText(e)},this);var r=[n.fTotCurrent,n.fTot1to30,n.fTot31to60,n.fTot61to90,n.fTotOver90];var i=r.reduce((t,e)=>t+e,0);var a=i===0?[0,0,0,0,0]:r.map(t=>t/i*100);this._updateDonutChart(a);this._updatePastDue(o);this._updateBalanceOwed(n.fTotInvoice,n.fTotAmountPaid);this._updateOpenInvoices(o);this._updateAvgAge(t)},_getValueOrZero:function(t,e){var o=t.getProperty(e);return o?parseFloat(o):0},_formatCurrency:function(t){if(t==null||t===undefined){return""}var e=sap.ui.getCore().getConfiguration().getLocale().getLanguage();var o;switch(e){case"en-US":o="USD";break;case"en-CA":o="CAD";break;case"fr-CA":o="CAD";break;default:o="USD";break}var n=sap.ui.core.format.NumberFormat.getCurrencyInstance({currencyCode:false,customCurrencies:{MyDollar:{isoCode:o,decimals:2}},groupingEnabled:true,showMeasure:true});return n.format(t,"MyDollar")},_getFooterIndex:function(t){var e={fTotCurrent:1,fTot1to30:2,fTot31to60:3,fTot61to90:4,fTotOver90:5,fTotInvoice:6,fTotAmountPaid:7};return e[t]||0},_updateDonutChart:function(t){var e=["_IDGenInteractiveDonutChartSegment","_IDGenInteractiveDonutChartSegment1","_IDGenInteractiveDonutChartSegment2","_IDGenInteractiveDonutChartSegment3","_IDGenInteractiveDonutChartSegment4"];e.forEach(function(e,o){this.byId(e).setValue(t[o]);this.byId(e).setDisplayedValue(t[o].toFixed(2)+"%")},this)},_updatePastDue:function(t){var e=0;t.forEach(function(t){var o=t.getObject();var n=o.NETDT?this._formatDate(o.NETDT):null;if(!n){return}var r=new Date;var i=o.NETWR-o.TSL;if(r>n&&i>0){e+=i}},this);var o=this._formatAmount(e);this.byId("_IDGenNumericContent2").setText(o)},_updateBalanceOwed:function(t,e){var o=t-e;var n=this._formatAmount(o);this.byId("_IDGenNumericContent1").setText(n)},_updateOpenInvoices:function(t){var e=t.filter(function(t){var e=t.getObject();var o=e.NETWR-e.TSL;return o>0}).length;this.byId("_IDGenNumericContent5").setText(e)},_updateAvgAge:function(t){var e=t.getBinding("rows");if(!e)return 0;var o=e.getContexts().map(function(t){return t.getObject()});var n=o.reduce(function(t,e){return t+(e.CAL_AGE||0)},0)/o.length;this.byId("_IDGenNumericContent4").setText(n.toFixed(1))},_formatAmount:function(t){if(t>=1e6)return"$"+(t/1e6).toFixed(2)+"M";if(t>=1e3)return"$"+(t/1e3).toFixed(2)+"K";return"$"+t.toFixed(2)},_formatDate:function(t){if(!t)return"";let e;if(typeof t==="string"){if(t.length===8){const o=t.slice(0,4)+"-"+t.slice(4,6)+"-"+t.slice(6,8);e=new Date(o+"T00:00:00Z")}else{return""}}else if(t instanceof Date){e=new Date(t.getTime())}else{return""}if(isNaN(e.getTime())){return""}e.setMinutes(e.getMinutes()+e.getTimezoneOffset());const o=sap.ui.core.format.DateFormat.getDateInstance({style:"medium"});return o.format(e)},onInvoiceClick:function(t){const e=t.getSource().getText();const o=`/mock-api/invoices/${e}`;this._fetchInvoiceImage(o).then(t=>this._showInvoiceDialog(t)).catch(t=>sap.m.MessageToast.show("Failed to load invoice"))},_fetchInvoiceImage:function(t){return new Promise((t,e)=>{setTimeout(()=>{t("https://via.placeholder.com/600x800.png?text=Invoice")},1e3)})},_showInvoiceDialog:function(t){const r=new e({title:"Invoice",content:new n({src:t,width:"100%"}),buttons:[new o({text:"Download",press:()=>this._downloadImage(t)}),new o({text:"Print",press:()=>this._printImage(t)}),new o({text:"Close",press:function(){r.close()}})]});r.open()},_downloadImage:function(t){const e=document.createElement("a");e.href=t;e.download="invoice.png";e.click()},_printImage:function(t){const e=window.open("");e.document.write(`<img src='${t}' style='width:100%;'/>`);e.print();e.close()}})});
//# sourceMappingURL=View1.controller.js.map