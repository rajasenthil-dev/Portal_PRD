sap.ui.define(["sap/ui/core/mvc/Controller"],t=>{"use strict";return t.extend("openar.controller.View1",{onInit:function(){var t=this.byId("table");var e=this.getOwnerComponent().getModel();t.setModel(e);t.attachEvent("rowsUpdated",this._calculateFooterAndSummary.bind(this))},_onTableUpdate:function(){this._calculateFooterAndSummary()},_calculateFooterAndSummary:function(){var t=this.byId("table");var e=t.getBinding("rows");var n=e.getContexts(0,e.getLength());if(!e)return;var r={fTotCurrent:0,fTot1to30:0,fTot31to60:0,fTot61to90:0,fTotOver90:0,fTotInvoice:0,fTotAmountPaid:0};n.forEach(function(t){r.fTotCurrent+=this._getValueOrZero(t,"CAL_CURRENT");r.fTot1to30+=this._getValueOrZero(t,"CAL_1_30");r.fTot31to60+=this._getValueOrZero(t,"CAL_31_60");r.fTot61to90+=this._getValueOrZero(t,"CAL_61_90");r.fTotOver90+=this._getValueOrZero(t,"CAL_OVER_90");r.fTotInvoice+=this._getValueOrZero(t,"NETWR");r.fTotAmountPaid+=this._getValueOrZero(t,"TSL")},this);Object.keys(r).forEach(function(t){var e=this._formatCurrency(r[t]);this.byId("footerText"+this._getFooterIndex(t)).setText(e)},this);var o=[r.fTotCurrent,r.fTot1to30,r.fTot31to60,r.fTot61to90,r.fTotOver90];var a=o.reduce((t,e)=>t+e,0);var i=a===0?[0,0,0,0,0]:o.map(t=>t/a*100);this._updateDonutChart(i);this._updatePastDue(n);this._updateBalanceOwed(r.fTotInvoice,r.fTotAmountPaid);this._updateOpenInvoices(n);this._updateAvgAge(t)},_getValueOrZero:function(t,e){var n=t.getProperty(e);return n?parseFloat(n):0},_formatCurrency:function(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},_getFooterIndex:function(t){var e={fTotCurrent:1,fTot1to30:2,fTot31to60:3,fTot61to90:4,fTotOver90:5,fTotInvoice:6,fTotAmountPaid:7};return e[t]||0},_updateDonutChart:function(t){var e=["_IDGenInteractiveDonutChartSegment","_IDGenInteractiveDonutChartSegment1","_IDGenInteractiveDonutChartSegment2","_IDGenInteractiveDonutChartSegment3","_IDGenInteractiveDonutChartSegment4"];e.forEach(function(e,n){this.byId(e).setValue(t[n]);this.byId(e).setDisplayedValue(t[n].toFixed(2)+"%")},this)},_updatePastDue:function(t){var e=0;t.forEach(function(t){var n=t.getObject();var r=n.NETDT?this._formatDate(n.NETDT):null;if(!r){return}var o=new Date;var a=n.NETWR-n.TSL;if(o>r&&a>0){e+=a}},this);var n=this._formatAmount(e);this.byId("_IDGenNumericContent2").setText(n)},_updateBalanceOwed:function(t,e){var n=t-e;var r=this._formatAmount(n);this.byId("_IDGenNumericContent1").setText(r)},_updateOpenInvoices:function(t){var e=t.filter(function(t){var e=t.getObject();var n=e.NETWR-e.TSL;return n>0}).length;this.byId("_IDGenNumericContent5").setText(e)},_updateAvgAge:function(t){var e=t.getBinding("rows");if(!e)return 0;var n=e.getContexts().map(function(t){return t.getObject()});var r=n.reduce(function(t,e){return t+(e.CAL_AGE||0)},0)/n.length;this.byId("_IDGenNumericContent4").setText(r.toFixed(1))},_formatAmount:function(t){if(t>=1e6)return"$"+(t/1e6).toFixed(2)+"M";if(t>=1e3)return"$"+(t/1e3).toFixed(2)+"K";return"$"+t.toFixed(2)},_formatDate:function(t){if(!t)return"";let e;if(typeof t==="string"){if(t.length===8){const n=t.slice(0,4)+"-"+t.slice(4,6)+"-"+t.slice(6,8);e=new Date(n+"T00:00:00Z")}else{return""}}else if(t instanceof Date){e=new Date(t.getTime())}else{return""}if(isNaN(e.getTime())){return""}e.setMinutes(e.getMinutes()+e.getTimezoneOffset());const n=sap.ui.core.format.DateFormat.getDateInstance({style:"medium"});return n.format(e)}})});
//# sourceMappingURL=View1.controller.js.map